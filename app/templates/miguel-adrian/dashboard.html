{% extends "base.html" %}
{% block title %}Panel{% endblock %}
{% block content %}
<div class="row">
  <div class="col-md-4">
    <div class="card auth-card p-4 shadow-sm mb-4">
      <h3 class="mb-3 text-center">Panel de Control</h3>
      <p class="text-center text-muted">Hola {{ name }} ({{ role }}).</p>

      <div class="d-grid mt-3">
        <a class="btn btn-outline-primary" href="{{ url_for('main.edit_profile') }}">
          Actualizar mis datos
        </a>
      </div>

      <div class="d-grid mt-2">
        <a class="btn btn-outline-primary" href="{{ url_for('friends.gestionar_amistades') }}">
          Gestionar Amistades
        </a>
      </div>

      {% if role == 'admin' %}
        <div class="d-grid mt-2">
          <a class="btn btn-outline-primary" href="{{ url_for('admin.admin_panel') }}">Ir a AdministraciÃ³n</a>
        </div>
      {% endif %}
    </div>
  </div>

  <div class="col-md-8">
    <div class="card p-4 shadow-sm">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h4 class="mb-0">ðŸ“¢ Actividad de Amigos (ChangeLog)</h4>
        
        <form action="{{ url_for('main.dashboard') }}" method="get" class="d-flex">
            <input type="text" name="filtro_usuario" class="form-control form-control-sm me-2" 
                   placeholder="Filtrar por usuario..." value="{{ filtro_actual or '' }}">
            <button type="submit" class="btn btn-sm btn-secondary">Filtrar</button>
            {% if filtro_actual %}
                <a href="{{ url_for('main.dashboard') }}" class="btn btn-sm btn-outline-danger ms-1">X</a>
            {% endif %}
        </form>
      </div>
      <hr>

      {% if eventos %}
        <div class="list-group list-group-flush">
            {% for evento in eventos %}
            <div class="list-group-item">
                <div class="d-flex w-100 justify-content-between">
                    <h6 class="mb-1 text-primary">@{{ evento.user.username }}</h6>
                    <small class="text-muted">{{ evento.created_at.strftime('%d/%m %H:%M') }}</small>
                </div>
                <p class="mb-1">{{ evento.description }}</p>
                <small class="text-secondary badge bg-light text-dark border">{{ evento.event_type }}</small>
            </div>
            {% endfor %}
        </div>
      {% else %}
        <div class="alert alert-light text-center">
            No hay actividad reciente {% if filtro_actual %} para el filtro aplicado {% endif %}.
        </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}